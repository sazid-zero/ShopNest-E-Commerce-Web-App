{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///E:/Frontend%20Projects/E-Commerce/src/lib/firebase-admin.ts"],"sourcesContent":["import \"server-only\";\r\nimport admin from 'firebase-admin';\r\n\r\nif (!admin.apps.length) {\r\n  admin.initializeApp({\r\n    credential: admin.credential.cert({\r\n      projectId: process.env.FIREBASE_PROJECT_ID,\r\n      clientEmail: process.env.FIREBASE_CLIENT_EMAIL,\r\n      privateKey: process.env.FIREBASE_PRIVATE_KEY?.replace(/\\\\n/g, '\\n'),\r\n    }),\r\n  });\r\n}\r\n\r\nexport const auth = admin.auth();\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,IAAI,CAAC,8LAAK,CAAC,IAAI,CAAC,MAAM,EAAE;IACtB,8LAAK,CAAC,aAAa,CAAC;QAClB,YAAY,8LAAK,CAAC,UAAU,CAAC,IAAI,CAAC;YAChC,WAAW,QAAQ,GAAG,CAAC,mBAAmB;YAC1C,aAAa,QAAQ,GAAG,CAAC,qBAAqB;YAC9C,YAAY,QAAQ,GAAG,CAAC,oBAAoB,EAAE,QAAQ,QAAQ;QAChE;IACF;AACF;AAEO,MAAM,OAAO,8LAAK,CAAC,IAAI"}},
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///E:/Frontend%20Projects/E-Commerce/src/lib/db.ts"],"sourcesContent":["import { Pool } from 'pg';\r\n\r\nconst pool = new Pool({\r\n  connectionString: process.env.DATABASE_URL,\r\n  ssl: {\r\n    rejectUnauthorized: false\r\n  }\r\n});\r\n\r\nexport default pool;\r\n"],"names":[],"mappings":";;;;AAAA;;;;;;AAEA,MAAM,OAAO,IAAI,qJAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;IAC1C,KAAK;QACH,oBAAoB;IACtB;AACF;uCAEe"}},
    {"offset": {"line": 88, "column": 0}, "map": {"version":3,"sources":["file:///E:/Frontend%20Projects/E-Commerce/src/lib/auth.ts"],"sourcesContent":["import { auth } from './firebase-admin';\r\nimport pool from './db';\r\n\r\nexport interface AuthUser {\r\n  id: string;\r\n  email: string;\r\n  name?: string;\r\n  role: 'customer' | 'seller' | 'admin';\r\n}\r\n\r\nexport async function verifyAndSyncUser(token: string): Promise<AuthUser | null> {\r\n  try {\r\n    const decodedToken = await auth.verifyIdToken(token);\r\n    const { uid, email, name } = decodedToken;\r\n\r\n    if (!email) throw new Error(\"Email missing in token\");\r\n\r\n    // Sync with local DB using ON CONFLICT for efficiency\r\n    const client = await pool.connect();\r\n    try {\r\n      // First, check if the user exists and what their role is\r\n      const userRes = await client.query(\"SELECT role FROM users WHERE id = $1\", [uid]);\r\n      let role: 'customer' | 'seller' | 'admin' = 'customer';\r\n\r\n      if (userRes.rows.length > 0) {\r\n        role = userRes.rows[0].role;\r\n      } else if (email === 'admin@shopnest.com') {\r\n        role = 'admin';\r\n      }\r\n\r\n      // Sync user data\r\n      const res = await client.query(\r\n        `INSERT INTO users (id, email, name, role) \r\n         VALUES ($1, $2, $3, $4) \r\n         ON CONFLICT (id) DO UPDATE SET email = EXCLUDED.email, name = EXCLUDED.name\r\n         RETURNING id, email, name, role`,\r\n        [uid, email, name || null, role]\r\n      );\r\n      \r\n      const user = res.rows[0];\r\n      return {\r\n        id: user.id,\r\n        email: user.email,\r\n        name: user.name,\r\n        role: user.role\r\n      };\r\n    } finally {\r\n      client.release();\r\n    }\r\n\r\n  } catch (error) {\r\n    console.error(\"Auth verification failed:\", error);\r\n    return null;\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;;;;;AASO,eAAe,kBAAkB,KAAa;IACnD,IAAI;QACF,MAAM,eAAe,MAAM,yIAAI,CAAC,aAAa,CAAC;QAC9C,MAAM,EAAE,GAAG,EAAE,KAAK,EAAE,IAAI,EAAE,GAAG;QAE7B,IAAI,CAAC,OAAO,MAAM,IAAI,MAAM;QAE5B,sDAAsD;QACtD,MAAM,SAAS,MAAM,6HAAI,CAAC,OAAO;QACjC,IAAI;YACF,yDAAyD;YACzD,MAAM,UAAU,MAAM,OAAO,KAAK,CAAC,wCAAwC;gBAAC;aAAI;YAChF,IAAI,OAAwC;YAE5C,IAAI,QAAQ,IAAI,CAAC,MAAM,GAAG,GAAG;gBAC3B,OAAO,QAAQ,IAAI,CAAC,EAAE,CAAC,IAAI;YAC7B,OAAO,IAAI,UAAU,sBAAsB;gBACzC,OAAO;YACT;YAEA,iBAAiB;YACjB,MAAM,MAAM,MAAM,OAAO,KAAK,CAC5B,CAAC;;;wCAG+B,CAAC,EACjC;gBAAC;gBAAK;gBAAO,QAAQ;gBAAM;aAAK;YAGlC,MAAM,OAAO,IAAI,IAAI,CAAC,EAAE;YACxB,OAAO;gBACL,IAAI,KAAK,EAAE;gBACX,OAAO,KAAK,KAAK;gBACjB,MAAM,KAAK,IAAI;gBACf,MAAM,KAAK,IAAI;YACjB;QACF,SAAU;YACR,OAAO,OAAO;QAChB;IAEF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,6BAA6B;QAC3C,OAAO;IACT;AACF"}},
    {"offset": {"line": 150, "column": 0}, "map": {"version":3,"sources":["file:///E:/Frontend%20Projects/E-Commerce/src/app/api/auth/sync/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\r\nimport { verifyAndSyncUser } from \"@/lib/auth\";\r\n\r\nexport async function POST(req: NextRequest) {\r\n  const authHeader = req.headers.get(\"Authorization\");\r\n  if (!authHeader?.startsWith(\"Bearer \")) {\r\n    return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n  }\r\n\r\n  const token = authHeader.split(\"Bearer \")[1];\r\n\r\n  const user = await verifyAndSyncUser(token);\r\n  \r\n  if (!user) {\r\n    return NextResponse.json({ error: \"Invalid token\" }, { status: 401 });\r\n  }\r\n\r\n  return NextResponse.json({ success: true, user });\r\n}\r\n\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;;;;;AAEO,eAAe,KAAK,GAAgB;IACzC,MAAM,aAAa,IAAI,OAAO,CAAC,GAAG,CAAC;IACnC,IAAI,CAAC,YAAY,WAAW,YAAY;QACtC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAe,GAAG;YAAE,QAAQ;QAAI;IACpE;IAEA,MAAM,QAAQ,WAAW,KAAK,CAAC,UAAU,CAAC,EAAE;IAE5C,MAAM,OAAO,MAAM,IAAA,yIAAiB,EAAC;IAErC,IAAI,CAAC,MAAM;QACT,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAgB,GAAG;YAAE,QAAQ;QAAI;IACrE;IAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,SAAS;QAAM;IAAK;AACjD"}}]
}