{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 42, "column": 0}, "map": {"version":3,"sources":["file:///E:/Frontend%20Projects/E-Commerce/src/lib/db.ts"],"sourcesContent":["import { Pool } from 'pg';\r\n\r\nconst pool = new Pool({\r\n  connectionString: process.env.DATABASE_URL,\r\n  ssl: {\r\n    rejectUnauthorized: false\r\n  }\r\n});\r\n\r\nexport default pool;\r\n"],"names":[],"mappings":";;;;AAAA;;;;;;AAEA,MAAM,OAAO,IAAI,qJAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;IAC1C,KAAK;QACH,oBAAoB;IACtB;AACF;uCAEe"}},
    {"offset": {"line": 66, "column": 0}, "map": {"version":3,"sources":["file:///E:/Frontend%20Projects/E-Commerce/src/app/api/products/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\r\nimport pool from \"@/lib/db\";\r\n\r\nexport async function GET(req: NextRequest) {\r\n  const { searchParams } = new URL(req.url);\r\n  const type = searchParams.get(\"type\");\r\n  const category = searchParams.get(\"category\");\r\n  const shopId = searchParams.get(\"shopId\");\r\n  const ids = searchParams.get(\"ids\")?.split(\",\").map(id => parseInt(id)).filter(id => !isNaN(id));\r\n\r\n  try {\r\n    const client = await pool.connect();\r\n    try {\r\n      let query = `\r\n        SELECT p.*, c.name as category_name, c.slug as category_slug \r\n        FROM products p\r\n        LEFT JOIN categories c ON p.category_id = c.id\r\n        WHERE 1=1\r\n      `;\r\n      const values: any[] = [];\r\n\r\n      if (ids && ids.length > 0) {\r\n        query += ` AND p.id = ANY($${values.length + 1})`;\r\n        values.push(ids);\r\n      }\r\n      if (type) {\r\n        values.push(type);\r\n        query += ` AND p.type = $${values.length}`;\r\n      }\r\n      if (category) {\r\n        values.push(category);\r\n        query += ` AND (c.slug = $${values.length} OR c.name = $${values.length})`;\r\n      }\r\n      if (shopId) {\r\n        values.push(shopId);\r\n        query += ` AND p.shop_id = $${values.length}`;\r\n      }\r\n\r\n      query += \" ORDER BY p.created_at DESC\";\r\n\r\n\r\n      const result = await client.query(query, values);\r\n      \r\n      // Transform DB row to match Frontend Product type if necessary\r\n      const products = result.rows.map(row => ({\r\n        id: row.id,\r\n        image: row.image_url,\r\n        title: row.name,\r\n        price: parseFloat(row.price),\r\n        original: row.original_price ? parseFloat(row.original_price) : undefined,\r\n        discount: row.discount,\r\n        rating: parseFloat(row.rating),\r\n        reviews: row.reviews_count,\r\n        type: row.type,\r\n        category: row.category_name,\r\n        description: row.description,\r\n        shopId: row.shop_id,\r\n        stock: row.stock\r\n      }));\r\n\r\n\r\n      return NextResponse.json(products);\r\n    } finally {\r\n      client.release();\r\n    }\r\n  } catch (error) {\r\n    console.error(\"Error fetching products:\", error);\r\n    return NextResponse.json({ error: \"Internal Server Error\" }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const body = await req.json();\r\n    const { name, price, original_price, discount, stock, description, image_url, category_id, shop_id, type } = body;\r\n\r\n    const client = await pool.connect();\r\n    try {\r\n      const res = await client.query(\r\n        `INSERT INTO products (name, price, original_price, discount, stock, description, image_url, category_id, shop_id, type)\r\n         VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10)\r\n         RETURNING *`,\r\n        [name, price, original_price || null, discount || 0, stock || 0, description, image_url, category_id, shop_id, type || 'new-arrival']\r\n      );\r\n      return NextResponse.json(res.rows[0]);\r\n    } finally {\r\n      client.release();\r\n    }\r\n  } catch (error: any) {\r\n    if (error.code === '23505') {\r\n      return NextResponse.json({ error: \"A product with this name already exists\" }, { status: 400 });\r\n    }\r\n    console.error(\"Error creating product:\", error);\r\n    return NextResponse.json({ error: \"Internal Server Error\" }, { status: 500 });\r\n  }\r\n}\r\n\r\n\r\n"],"names":[],"mappings":"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"}}]
}