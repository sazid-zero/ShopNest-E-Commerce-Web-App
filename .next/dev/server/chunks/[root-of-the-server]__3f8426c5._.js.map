{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 42, "column": 0}, "map": {"version":3,"sources":["file:///E:/Frontend%20Projects/E-Commerce/src/lib/db.ts"],"sourcesContent":["import { Pool } from 'pg';\r\n\r\nconst pool = new Pool({\r\n  connectionString: process.env.DATABASE_URL,\r\n  ssl: {\r\n    rejectUnauthorized: false\r\n  }\r\n});\r\n\r\nexport default pool;\r\n"],"names":[],"mappings":";;;;AAAA;;;;;;AAEA,MAAM,OAAO,IAAI,qJAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;IAC1C,KAAK;QACH,oBAAoB;IACtB;AACF;uCAEe"}},
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///E:/Frontend%20Projects/E-Commerce/src/lib/firebase-admin.ts"],"sourcesContent":["import \"server-only\";\r\nimport admin from 'firebase-admin';\r\n\r\nif (!admin.apps.length) {\r\n  admin.initializeApp({\r\n    credential: admin.credential.cert({\r\n      projectId: process.env.FIREBASE_PROJECT_ID,\r\n      clientEmail: process.env.FIREBASE_CLIENT_EMAIL,\r\n      privateKey: process.env.FIREBASE_PRIVATE_KEY?.replace(/\\\\n/g, '\\n'),\r\n    }),\r\n  });\r\n}\r\n\r\nexport const auth = admin.auth();\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,IAAI,CAAC,8LAAK,CAAC,IAAI,CAAC,MAAM,EAAE;IACtB,8LAAK,CAAC,aAAa,CAAC;QAClB,YAAY,8LAAK,CAAC,UAAU,CAAC,IAAI,CAAC;YAChC,WAAW,QAAQ,GAAG,CAAC,mBAAmB;YAC1C,aAAa,QAAQ,GAAG,CAAC,qBAAqB;YAC9C,YAAY,QAAQ,GAAG,CAAC,oBAAoB,EAAE,QAAQ,QAAQ;QAChE;IACF;AACF;AAEO,MAAM,OAAO,8LAAK,CAAC,IAAI"}},
    {"offset": {"line": 88, "column": 0}, "map": {"version":3,"sources":["file:///E:/Frontend%20Projects/E-Commerce/src/lib/auth.ts"],"sourcesContent":["import { auth } from './firebase-admin';\r\nimport pool from './db';\r\n\r\nexport interface AuthUser {\r\n  id: string;\r\n  email: string;\r\n  name?: string;\r\n  role: 'customer' | 'seller' | 'admin';\r\n}\r\n\r\nexport async function verifyAndSyncUser(token: string): Promise<AuthUser | null> {\r\n  try {\r\n    const decodedToken = await auth.verifyIdToken(token);\r\n    const { uid, email, name } = decodedToken;\r\n\r\n    if (!email) throw new Error(\"Email missing in token\");\r\n\r\n    // Sync with local DB using ON CONFLICT for efficiency\r\n    const client = await pool.connect();\r\n    try {\r\n      // First, check if the user exists and what their role is\r\n      const userRes = await client.query(\"SELECT role FROM users WHERE id = $1\", [uid]);\r\n      let role: 'customer' | 'seller' | 'admin' = 'customer';\r\n\r\n      if (userRes.rows.length > 0) {\r\n        role = userRes.rows[0].role;\r\n      } else if (email === 'admin@shopnest.com') {\r\n        role = 'admin';\r\n      }\r\n\r\n      // Sync user data\r\n      const res = await client.query(\r\n        `INSERT INTO users (id, email, name, role) \r\n         VALUES ($1, $2, $3, $4) \r\n         ON CONFLICT (id) DO UPDATE SET email = EXCLUDED.email, name = EXCLUDED.name\r\n         RETURNING id, email, name, role`,\r\n        [uid, email, name || null, role]\r\n      );\r\n      \r\n      const user = res.rows[0];\r\n      return {\r\n        id: user.id,\r\n        email: user.email,\r\n        name: user.name,\r\n        role: user.role\r\n      };\r\n    } finally {\r\n      client.release();\r\n    }\r\n\r\n  } catch (error) {\r\n    console.error(\"Auth verification failed:\", error);\r\n    return null;\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;;;;;AASO,eAAe,kBAAkB,KAAa;IACnD,IAAI;QACF,MAAM,eAAe,MAAM,yIAAI,CAAC,aAAa,CAAC;QAC9C,MAAM,EAAE,GAAG,EAAE,KAAK,EAAE,IAAI,EAAE,GAAG;QAE7B,IAAI,CAAC,OAAO,MAAM,IAAI,MAAM;QAE5B,sDAAsD;QACtD,MAAM,SAAS,MAAM,6HAAI,CAAC,OAAO;QACjC,IAAI;YACF,yDAAyD;YACzD,MAAM,UAAU,MAAM,OAAO,KAAK,CAAC,wCAAwC;gBAAC;aAAI;YAChF,IAAI,OAAwC;YAE5C,IAAI,QAAQ,IAAI,CAAC,MAAM,GAAG,GAAG;gBAC3B,OAAO,QAAQ,IAAI,CAAC,EAAE,CAAC,IAAI;YAC7B,OAAO,IAAI,UAAU,sBAAsB;gBACzC,OAAO;YACT;YAEA,iBAAiB;YACjB,MAAM,MAAM,MAAM,OAAO,KAAK,CAC5B,CAAC;;;wCAG+B,CAAC,EACjC;gBAAC;gBAAK;gBAAO,QAAQ;gBAAM;aAAK;YAGlC,MAAM,OAAO,IAAI,IAAI,CAAC,EAAE;YACxB,OAAO;gBACL,IAAI,KAAK,EAAE;gBACX,OAAO,KAAK,KAAK;gBACjB,MAAM,KAAK,IAAI;gBACf,MAAM,KAAK,IAAI;YACjB;QACF,SAAU;YACR,OAAO,OAAO;QAChB;IAEF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,6BAA6B;QAC3C,OAAO;IACT;AACF"}},
    {"offset": {"line": 150, "column": 0}, "map": {"version":3,"sources":["file:///E:/Frontend%20Projects/E-Commerce/src/app/api/dashboard/stats/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\r\nimport pool from \"@/lib/db\";\r\nimport { verifyAndSyncUser } from \"@/lib/auth\";\r\n\r\nexport async function GET(req: NextRequest) {\r\n  const authHeader = req.headers.get(\"Authorization\");\r\n  if (!authHeader?.startsWith(\"Bearer \")) {\r\n    return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n  }\r\n\r\n  const token = authHeader.split(\"Bearer \")[1];\r\n  const user = await verifyAndSyncUser(token);\r\n  if (!user || (user.role !== 'admin' && user.role !== 'seller')) {\r\n    return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\r\n  }\r\n\r\n  const client = await pool.connect();\r\n\r\n  try {\r\n    if (user.role === 'admin') {\r\n      const statsRes = await client.query(`\r\n        SELECT \r\n          (SELECT COUNT(*) FROM orders) as total_orders,\r\n          (SELECT COUNT(*) FROM products) as total_products,\r\n          (SELECT COUNT(*) FROM shops) as total_shops,\r\n          (SELECT SUM(total_amount) FROM orders) as total_revenue\r\n      `);\r\n\r\n      const recentActivityRes = await client.query(`\r\n        SELECT id, substring(id::text, 1, 8) as short_id, total_amount, created_at, status\r\n        FROM orders ORDER BY created_at DESC LIMIT 5\r\n      `);\r\n\r\n      return NextResponse.json({\r\n        stats: [\r\n          { name: 'Total Orders', value: statsRes.rows[0].total_orders, icon: 'ShoppingCart', color: 'bg-blue-500' },\r\n          { name: 'Active Products', value: statsRes.rows[0].total_products, icon: 'Package', color: 'bg-green-500' },\r\n          { name: 'Total Shops', value: statsRes.rows[0].total_shops, icon: 'Store', color: 'bg-purple-500' },\r\n          { name: 'Revenue', value: `৳${Number(statsRes.rows[0].total_revenue || 0).toLocaleString()}`, icon: 'TrendingUp', color: 'bg-orange-500' },\r\n        ],\r\n        recentActivity: recentActivityRes.rows.map(order => ({\r\n          label: `New Order #ORD-${order.short_id}`,\r\n          time: order.created_at,\r\n          amount: `৳${Number(order.total_amount).toLocaleString()}`,\r\n          status: order.status\r\n        }))\r\n      });\r\n    }\r\n\r\n    if (user.role === 'seller') {\r\n      // Find seller's shop\r\n      const shopRes = await client.query(\"SELECT id FROM shops WHERE owner_id = $1\", [user.id]);\r\n      const shopId = shopRes.rows[0]?.id;\r\n\r\n      if (!shopId) {\r\n        return NextResponse.json({ stats: [], recentActivity: [] });\r\n      }\r\n\r\n      const statsRes = await client.query(`\r\n        SELECT \r\n          (SELECT COUNT(DISTINCT oi.order_id) FROM order_items oi JOIN products p ON oi.product_id = p.id WHERE p.shop_id = $1) as total_orders,\r\n          (SELECT COUNT(*) FROM products WHERE shop_id = $1) as total_products,\r\n          (SELECT SUM(oi.price * oi.quantity) FROM order_items oi JOIN products p ON oi.product_id = p.id WHERE p.shop_id = $1) as total_revenue\r\n      `, [shopId]);\r\n\r\n      const recentActivityRes = await client.query(`\r\n        SELECT DISTINCT o.id, substring(o.id::text, 1, 8) as short_id, o.created_at, o.status\r\n        FROM orders o\r\n        JOIN order_items oi ON o.id = oi.order_id\r\n        JOIN products p ON oi.product_id = p.id\r\n        WHERE p.shop_id = $1\r\n        ORDER BY o.created_at DESC LIMIT 5\r\n      `, [shopId]);\r\n\r\n      return NextResponse.json({\r\n        stats: [\r\n          { name: 'Total Orders', value: statsRes.rows[0].total_orders, icon: 'ShoppingCart', color: 'bg-blue-500' },\r\n          { name: 'My Products', value: statsRes.rows[0].total_products, icon: 'Package', color: 'bg-green-500' },\r\n          { name: 'Shop Revenue', value: `৳${Number(statsRes.rows[0].total_revenue || 0).toLocaleString()}`, icon: 'TrendingUp', color: 'bg-orange-500' },\r\n        ],\r\n        recentActivity: recentActivityRes.rows.map(order => ({\r\n          label: `Sales Order #ORD-${order.short_id}`,\r\n          time: order.created_at,\r\n          amount: 'View Details',\r\n          status: order.status\r\n        }))\r\n      });\r\n    }\r\n\r\n    if (user.role === 'customer') {\r\n      const statsRes = await client.query(`\r\n        SELECT \r\n          COUNT(*) as total_orders,\r\n          SUM(total_amount) as total_spent\r\n        FROM orders WHERE user_id = $1\r\n      `, [user.id]);\r\n\r\n      const recentActivityRes = await client.query(`\r\n        SELECT id, substring(id::text, 1, 8) as short_id, total_amount, created_at, status\r\n        FROM orders WHERE user_id = $1 ORDER BY created_at DESC LIMIT 5\r\n      `, [user.id]);\r\n\r\n      return NextResponse.json({\r\n        stats: [\r\n          { name: 'My Orders', value: statsRes.rows[0].total_orders, icon: 'ShoppingCart', color: 'bg-blue-500' },\r\n          { name: 'Total Spent', value: `৳${Number(statsRes.rows[0].total_spent || 0).toLocaleString()}`, icon: 'TrendingUp', color: 'bg-orange-500' },\r\n        ],\r\n        recentActivity: recentActivityRes.rows.map(order => ({\r\n          label: `Order #ORD-${order.short_id}`,\r\n          time: order.created_at,\r\n          amount: `৳${Number(order.total_amount).toLocaleString()}`,\r\n          status: order.status\r\n        }))\r\n      });\r\n    }\r\n\r\n    return NextResponse.json({ stats: [], recentActivity: [] });\r\n\r\n  } catch (error: any) {\r\n    console.error(\"Dashboard stats fetch failed:\", error);\r\n    return NextResponse.json({ error: \"Internal Server Error\" }, { status: 500 });\r\n  } finally {\r\n    client.release();\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}